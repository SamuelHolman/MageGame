<html>

<% include ./partials/header %>

    <body>
        <% include ./partials/navbar %>
            <% include ./partials/scripts %>

                <canvas id="GameArea"></canvas>

                <script>
                    let WindowHeight = $(window).height();
                    let WindowWidth = $(window).width();
                    let MapCoordinateX = 0;
                    let MapCoordinateY = 0;
                    let PlayerXSize = 50;
                    let PlayerYSize = 50;
                    let MapSizeX = 8783;
                    let MapSizeY = 8783;
                    let XOffset = WindowWidth / 2;
                    let YOffset = WindowHeight / 2;
                    let PlayerCoordinateX = MapCoordinateX + XOffset;
                    let PlayerCoordinateY = MapCoordinateY + YOffset;
                    let TimerCheckUp = null;
                    let TimerCheckDown = null;
                    let TimerCheckLeft = null;
                    let TimerCheckRight = null;
                    let MovementAmount = 2;
                    let Delay = 8;



                    var GameAreaSelector = document.getElementById("GameArea");
                    var game = GameAreaSelector.getContext("2d");

                    window.requestAnimationFrame(GameFrame);

                    GameMap = new Image();

                    function GameFrame() {
                        GameMap.src = '/images/Map.png';
                        RenderPlayer();
                        window.requestAnimationFrame(GameFrame);
                    }

                    function resize() {
                        GameAreaSelector.width = window.innerWidth;
                        GameAreaSelector.height = window.innerHeight;
                        XOffset = WindowWidth / 2;
                        YOffset = WindowHeight / 2;
                    }

                    resize()
                    window.addEventListener('resize', resize)

                    GameMap.onload = function () {
                        game.fillStyle = "#654987";
                        game.fillRect(-1000, -1000, 10000, 10000);
                        game.drawImage(GameMap, MapCoordinateX, MapCoordinateY, WindowWidth, WindowHeight, 0, 0, WindowWidth, WindowHeight);
                    };

                    GameMap.src = '/images/Map.png';

                    function RenderPlayer() {
                        game.fillStyle = "#999999";
                        game.fillRect(WindowWidth / 2 - 25, WindowHeight / 2 - 25, PlayerXSize, PlayerYSize);
                    }

                    function MovementCheck() {
                        if (PlayerCoordinateY <= 0) {
                            return 1;
                        } else if (PlayerCoordinateY >= MapSizeY) {
                            return 2;
                        } else if (PlayerCoordinateX <= 0) {
                            return 3;
                        } else if (PlayerCoordinateX >= MapSizeX) {
                            return 4;
                        }
                    }

                    function SyncPlayerCoordinates() {
                        PlayerCoordinateX = MapCoordinateX + XOffset;
                        PlayerCoordinateY = MapCoordinateY + YOffset;
                    }

                    function Move(Direction) {
                        SyncPlayerCoordinates();
                        switch (Direction) {
                            case 1:
                                if (MovementCheck(1) == 1) {
                                    break;
                                }
                                MapCoordinateY -= MovementAmount;
                                break;
                            case 2:
                                if (MovementCheck(2) == 2) {
                                    break;
                                }
                                MapCoordinateY += MovementAmount;
                                break;
                            case 3:
                                if (MovementCheck(3) == 3) {
                                    break;
                                }
                                MapCoordinateX -= MovementAmount;
                                break;
                            case 4:
                                if (MovementCheck(4) == 4) {
                                    break;
                                }
                                MapCoordinateX += MovementAmount;
                        }
                    }

                    $("body").keydown(function (Key) {
                        if (Key.which == 38) {
                            if (TimerCheckUp == null) {
                                TimerCheckUp = setInterval(Move, Delay, 1);
                            }
                        } else if (Key.which == 40) {
                            if (TimerCheckDown == null) {
                                TimerCheckDown = setInterval(Move, Delay, 2);
                            }
                        } else if (Key.which == 37) {
                            if (TimerCheckLeft == null) {
                                TimerCheckLeft = setInterval(Move, Delay, 3);
                            }
                        } else if (Key.which == 39) {
                            if (TimerCheckRight == null) {
                                TimerCheckRight = setInterval(Move, Delay, 4);
                            }
                        } else if (Key.which == 90) {
                            alert(`${WindowWidth} ${WindowHeight}`);
                        }
                    });

                    $("body").keyup(function (Key) {
                        if (Key.which == 38) {
                            clearInterval(TimerCheckUp);
                            TimerCheckUp = null;
                        } else if (Key.which == 40) {
                            clearInterval(TimerCheckDown);
                            TimerCheckDown = null;
                        } else if (Key.which == 37) {
                            clearInterval(TimerCheckLeft);
                            TimerCheckLeft = null;
                        } else if (Key.which == 39) {
                            clearInterval(TimerCheckRight);
                            TimerCheckRight = null;
                        } else if (Key.which == 90) {
                            //Use();
                        } else if (Key.which == 85) {
                            // document.getElementById("GameArea").requestFullscreen();
                            // // document.location.reload(true);
                            // let WindowHeight = $(window).height();
                            // let WindowWidth = $(window).width();
                            // resize();
                            // GameMap.src = '/images/Map.png';                             // FIX FULLSCREEN
                        }
                        // alert(Key.which);
                    });



                </script>
    </body>

</html>